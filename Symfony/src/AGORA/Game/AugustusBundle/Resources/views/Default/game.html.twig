<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Augustus - {{ gameName }}</title>
        <link rel="stylesheet" type="text/css" href="{{ asset('bundles/agoragameaugustus/css/game.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ asset('bundles/agoragameaugustus/css/tchat.css') }}">
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script> var playerUsername = "";</script>
    </head>

    <body>
        <div class="overlay" onclick="removeOverlay(this)">
            <div class="overlayContent" onclick="event.stopPropagation()">
                <!-- TODO rien mdr -->
            </div>
        </div>

        <div id="gameContent" class="flexContainer">
            <div id="playersInfo" class="flexContainer flexColumn">
                <div id="allPlayersInfo" class="flexContainer flexColumn">
                    {% for player in game.players %}
                        <div class="playerInfo" onclick="selectPlayer(this)">
                            <p class="p">
                                {{ player.name ? player.name : "null" }}<br>
                                Légions : {{ player.legion }}/{{ player.legionMax }}<br>
                                Objectifs sous contrôle : {{ player.ctrlObj|length }}
                            </p>
                        </div>
                    {% endfor %}
                </div>

                <div class="flex1"></div>

                <div id="myInfo">
                    <p class="p">
                        {{ me.name }}<br>
                        Légions :<br>
                        {{ me.legion }}/{{ me.legionMax }}<br>
                        Score :<br>
                        {{ me.score }}
                        <br>
                        Resssources :<br>
                        Blé : {{ me.wheat }}<br>
                        Or : {{ me.gold }}<br>
                    </p>
                </div>
            </div>

            <div class="flex1"></div>

            <div id="boardAndHand" class="flexContainer flexColumn">
                <div id="instructions">
                    <p class="p">{# TODO instructions #}</p>
                </div>

                
                <div id="playerBar" class="flexContainer flexRow">
                    {# TODO un <selectedPlayerInfo> par joueur, invisibles#}
                    <div class="selectedPlayerInfo">
                        <div>
                            <p class="p">
                        
                                {{ selectedPlayer.name }}<br>
                                Légions :<br>
                                {{ selectedPlayer.legion }}/{{ selectedPlayer.legionMax }}
                            </p>
                        </div>

                        <div class="flex1"></div>

                        {% for card in selectedPlayer.currObj %}
                            <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ card.number ~ '.jpg') }}" alt="Card{{ card.number }}" height="170" ondblclick="getOverlay(this)">
                        {% endfor %}

                        <div class="flex1"></div>

                        <div class="flexContainer flexColumn">
                            <button>Captures</button>
                            <button>Récompenses</button>
                        </div>
                    </div>
                </div>

                <!-- <div class="flex1"></div> -->

                <div id="boardBar" class="flexContainer flexRow">
                    <div class="flex1"></div>

                    <div id="lootBars" class="flexContainer flexColumn">
                        <div id="topLoot" class="flexContainer flexRow">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/Loot2Cards.jpg') }}" alt="Loot2Cards" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/Loot3Cards.jpg') }}" alt="Loot3Cards" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/Loot4Cards.jpg') }}" alt="Loot4Cards" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/Loot5Cards.jpg') }}" alt="Loot5Cards" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/Loot6Cards.jpg') }}" alt="Loot6Cards" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootGold.jpg') }}" alt="LootGold" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                        </div>

                        <div class="flex1"></div>

                        <div id="botLoot" class="flexContainer flexRow">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootSenator.jpg') }}" alt="LootSenator" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootGreen.jpg') }}" alt="LootGreen" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootMulti.jpg') }}" alt="LootMulti" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootRose.jpg') }}" alt="LootRose" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootOrange.jpg') }}" alt="LootOrange" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <img src="{{ asset('bundles/agoragameaugustus/img/Loot/LootWheat.jpg') }}" alt="LootWheat" height="100" class="{{ not loot.isAvailable ? taken }}" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                        </div>
                    </div>

                    <div class="flex1"></div>

                    <div id="objLine" class="flexContainer flexRow">
                        <div class="flexContainer flexColumn">
                            <div>
                                <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ game.board.objLine[0].number ~ '.jpg') }}" alt="Card{{ board.objLine[0].number }}" height="100" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                                <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ game.board.objLine[1].number ~ '.jpg') }}" alt="Card{{ board.objLine[1].number }}" height="100" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            </div>
                            <div>
                                <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ game.board.objLine[2].number ~ '.jpg') }}" alt="Card{{ board.objLine[2].number }}" height="100" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                                <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ game.board.objLine[3].number ~ '.jpg') }}" alt="Card{{ board.objLine[3].number }}" height="100" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            </div>
                        </div>
                        <div class="flexContainer flexColumn">
                            <div class="flex1"></div>
                            <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ game.board.objLine[4].number ~ '.jpg') }}" alt="Card{{ board.objLine[4].number }}" height="100" onclick="selectBoard(this)" ondblclick="getOverlay(this)">
                            <div class="flex1"></div>
                        </div>
                    </div>
                </div>

                <!-- <div class="flex1"></div> -->

                <div id="myBar" class="flexContainer flexRow">
                    {% for card in me.currObj %}
                        <img src="{{ asset('bundles/agoragameaugustus/img/Cards/' ~ card.number ~ '.jpg') }}" alt="Card{{ card.number }}" height="200" onclick="selectHand(this)" ondblclick="getOverlay()">
                    {% endfor %}

                    <div class="flex1"></div>

                    <div class="flexContainer flexColumn">
                        <button>Captures</button>
                        <button>Récompenses</button>
                    </div>
                </div>

                <div id="buttons" class="flexContainer flexRow">
                    <div class="flex1"></div>
                    <button onclick="validate()">Valider</button>
                    <button onclick="resetSelected()">Annuler</button>
                    <div class="flex1"></div>
                </div>
            </div>

            <div class="flex1"></div>

            <div id="tokenInfo" class="flexContainer flexColumn">
                <img src="{{ asset('bundles/agoragameaugustus/img/Token/TokenCount.jpg') }}" alt="TokenHelp" width="150">
                <div class="flexContainer flexRow">
                    <p class="p">Jeton du tour : </p>
                    <img src="{{ asset('bundles/agoragameaugustus/img/Token/Token' ~ game.currToken ~ '.jpg') }}" alt="{{ game.currToken }}" height="55">
                </div>
            </div>
        </div>

        <!-- THERE WAS LINE 151 to 388 FROM AVE CESAR GAME TWIG -->

        <!-- SCRIPTS -->
        <script>
            function getOverlay(element) {//TODO
                //TODO display info from parameter (document...innerHTML)
                document.querySelector(".overlay").classList.add("visible");
                
            }

            function removeOverlay(element) {
                document.querySelector(".overlay").classList.remove("visible");
                //TODO  rien mdr
            }

            function validate() {
                //DO VARIOUS THINGS
                //TODO

                resetSelected();
            }

            function resetSelected() {
                var board = document.querySelectorAll(".selectedBoard");
                var hand = document.querySelectorAll(".selectedHand");

                board.forEach(function (element) {
                    element.classList.remove("selectedBoard");
                });
                hand.forEach(function (element) {
                    element.classList.remove("selectedHand");
                });
            }

            function selectHand(e) {
                resetSelected();
                var src = e;
                src.classList.add("selectedHand");
            }

            function selectBoard(e) {
                resetSelected();
                var src = e;
                src.classList.add("selectedBoard");
            }

            function resetSelectedPlayer() {
                var e = document.querySelectorAll(".selectedPlayer");

                e.forEach(function (element) {
                    element.classList.remove("selectedPlayer");
                });
            }

            function selectPlayer(e) {
                resetSelectedPlayer();
                e.classList.add("selectedPlayer");

                //TODO set visible info correspondant au joueur
            }
        </script>

        <!-- TCHAT DIV + SCRIPT -->
        <div class="tchat">
            <div class="titleTchat">
                <img id="flecheTchat" src="{{ asset('bundles/agoragameavecesar/image/fleche_historique_bas.png') }}" alt="x">
                <i>Chat du lobby</i>
            </div>
            <div id="discussion"></div>
            <textarea id="UserMessage" placeholder="Entrez votre message ici"></textarea>
        </div>
        <button id="buttAcc" onclick="window.location.href = '{{ app.request.getSchemeAndHttpHost() }}'">Accueil</button>
        <script>//Script gérant le tchat
            document.getElementById('UserMessage').addEventListener('keypress', function (event) {
                var key = event.hasOwnProperty('which') ? event.which : event.keyCode;
                if (key === 13) { // 13 est la touche entrée
                    var div = document.createElement("div");
                    var message = document.getElementById('UserMessage').value;
                    /*
                    var clientInformation = {
                        gameId: {{ game.id }},
                            playerId: {{ player.id }},
                            action : {
                                type: "message",
                                username: playerUsername,
                                message: message
                                },
                            gameCode : "aug"
                        };
                        */
                    div.textContent = "Moi : " + message;
                    document.getElementById('UserMessage').value = "";
                    div.className = "messageMy";
                    document.getElementById("discussion").appendChild(div);
                    conn.send(JSON.stringify(clientInformation));
                }
            });
            var flecheTchat = document.getElementById("flecheTchat");
            flecheTchat.addEventListener("click", tchatOnClick);
        </script>
    </body>
</html>